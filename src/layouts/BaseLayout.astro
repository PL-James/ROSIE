---
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
  showSidebar?: boolean;
}

const { title, description = 'Compliance as Code for GxP Systems', showSidebar = false } = Astro.props;
const currentPath = Astro.url.pathname;

const nav = [
  { title: 'Home', url: '/' },
  { title: 'ðŸš€ Try Demo', url: '/demo/' },
  { title: 'Core', url: '/core/' },
  {
    title: 'Specs',
    url: '/specs/',
    children: [
      { title: 'RFC-001: Data Standard', url: '/specs/rfc-001/' },
      { title: 'RFC-002: Engine Spec', url: '/specs/rfc-002/' },
      { title: 'RFC-003: Evidence Standard', url: '/specs/rfc-003/' },
      { title: 'RFC-004: API Interface', url: '/specs/rfc-004/' },
      { title: 'RFC-005: TQ Baseline', url: '/specs/rfc-005/' },
    ]
  },
  { title: 'Regulatory Guide', url: '/regulatory/' },
  { title: 'Reference', url: '/reference/' },
];
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title} | ROSIE</title>
  <meta name="description" content={description}>
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:type" content="website">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>R</text></svg>">
</head>
<body>
  <header class="site-header">
    <div class="header-container">
      <a href="/" class="site-logo">
        <span class="logo-icon">R</span>
        <span class="logo-text">ROSIE</span>
      </a>

      <button class="nav-toggle" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <nav class="nav-menu">
        {nav.map((item) => (
          <div class={`nav-item ${item.children ? 'has-children' : ''}`}>
            <a href={item.url} class={currentPath === item.url ? 'active' : ''}>
              {item.title}
              {item.children && (
                <svg class="dropdown-icon" width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <path d="M3 5L6 8L9 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              )}
            </a>
            {item.children && (
              <div class="nav-dropdown">
                {item.children.map((child) => (
                  <a href={child.url} class={currentPath === child.url ? 'active' : ''}>
                    {child.title}
                  </a>
                ))}
              </div>
            )}
          </div>
        ))}
      </nav>
    </div>
  </header>

  <div class="layout">
    {showSidebar && (
      <aside class="sidebar">
        <div class="sidebar-section">
          <h3 class="sidebar-title">Specifications</h3>
          <nav class="sidebar-nav">
            <a href="/specs/" class={currentPath === '/specs/' ? 'active' : ''}>Overview</a>
            <a href="/specs/rfc-001/" class={currentPath.includes('rfc-001') ? 'active' : ''}>
              <span class="rfc-badge">001</span> Data Standard
            </a>
            <a href="/specs/rfc-002/" class={currentPath.includes('rfc-002') ? 'active' : ''}>
              <span class="rfc-badge">002</span> Engine Spec
            </a>
            <a href="/specs/rfc-003/" class={currentPath.includes('rfc-003') ? 'active' : ''}>
              <span class="rfc-badge">003</span> Evidence Standard
            </a>
            <a href="/specs/rfc-004/" class={currentPath.includes('rfc-004') ? 'active' : ''}>
              <span class="rfc-badge">004</span> API Interface
            </a>
            <a href="/specs/rfc-005/" class={currentPath.includes('rfc-005') ? 'active' : ''}>
              <span class="rfc-badge">005</span> TQ Baseline
            </a>
          </nav>
        </div>
        <div class="sidebar-section">
          <h3 class="sidebar-title">Resources</h3>
          <nav class="sidebar-nav">
            <a href="/core/" class={currentPath === '/core/' ? 'active' : ''}>Core Concepts</a>
            <a href="/regulatory/" class={currentPath === '/regulatory/' ? 'active' : ''}>Regulatory Mapping</a>
            <a href="/reference/" class={currentPath === '/reference/' ? 'active' : ''}>Reference Implementation</a>
          </nav>
        </div>
      </aside>
    )}

    <main class={`main-content ${showSidebar ? 'with-sidebar' : ''}`}>
      <slot />
    </main>
  </div>

  <footer class="site-footer">
    <div class="footer-container">
      <div class="footer-content">
        <div class="footer-brand">
          <span class="logo-icon">R</span>
          <span class="footer-tagline">Compliance as Code for GxP Systems</span>
        </div>
        <div class="footer-links">
          <a href="/specs/">Specifications</a>
          <a href="/regulatory/">Regulatory Guide</a>
          <a href="https://github.com/PL-James/ROSIE" target="_blank" rel="noopener">GitHub</a>
        </div>
      </div>
      <div class="footer-bottom">
        <p class="footer-license">
          Licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="noopener">CC BY-NC-ND 4.0</a>
        </p>
        <p class="footer-alignment">Aligned with GAMP 5 | CSA | 21 CFR Part 11</p>
      </div>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const navToggle = document.querySelector('.nav-toggle');
      const navMenu = document.querySelector('.nav-menu');

      if (navToggle && navMenu) {
        navToggle.addEventListener('click', function() {
          navMenu.classList.toggle('active');
          navToggle.classList.toggle('active');
        });
      }

      document.querySelectorAll('.nav-item.has-children > a').forEach(function(link) {
        link.addEventListener('click', function(e) {
          if (window.innerWidth <= 768) {
            e.preventDefault();
            const dropdown = this.nextElementSibling;
            dropdown.classList.toggle('active');
          }
        });
      });
    });
  </script>
</body>
</html>
